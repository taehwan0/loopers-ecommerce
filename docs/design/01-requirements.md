# 요구사항 정리

## 목차

- [사용자 흐름](#사용자-흐름)
- [기능 도출 및 요구사항 정리](#기능-도출-및-요구사항-정리)
  - [상품 관련](#상품-관련)
  - [브랜드 관련](#브랜드-관련)
  - [주문 관련](#주문-관련)

---

## 사용자 흐름

- 사용자는 상품 목록을 통해 원하는 상품을 탐색한다.
    - 상품 목록을 탐색하며 상세한 내용을 보고 싶은 상품은 상세 조회를 통해 세부적인 내용을 확인한다.
- 마음에 드는 상품을 발견 했다면, LIKE 버튼을 눌러 좋아하는 상품으로 표기 할 수 있다.
    - LIKE 표기한 상품들은 LIKE 목록에서 모아 볼 수 있다.
    - LIKE 표기한 상품에 흥미가 떨어졌다면, LIKE 등록을 취소할 수 있다.
- 상품은 특정 브랜드 안에 속한다.
    - 각각의 브랜드는 브랜드 홈을 가진다. 브랜드 홈에서는 브랜드 정보를 볼 수 있다.
    - 그리고 브랜드의 상품들을 모아 볼 수 있다.
- 원하는 상품을 골랐다면 주문을 생성해 상품을 구매할 수 있다.
    - 주문에 해당하는 상품의 재고가 충분하고 결제 금액 이상의 포인트가 잔액으로 남아있다면 결제를 할 수 있다.
    - 결제를 성공하면 성공적으로 주문이 완료된다.
- 주문을 성공적으로 완료했다면, 사용자는 상품 배송을 기다려 원하던 상품을 만나게 된다.
- 주문 내역 화면에서는 지금 까지의 주문 이력을 확인 할 수 있다.

---

## 기능 도출 및 요구사항 정리
 
### 상품 관련

#### 상품 목록 조회

**기능적 요구사항**
- 성공 케이스
  - 사용자는 상품 목록을 조회할 수 있다.
  - 상품 목록 조회 시 카테고리 별 필터링하여 조회할 수 있다.
- 예외 케이스
  - \-
- 실패 케이스
  - \-

**비기능적 요구사항**
- 상품이 존재하지 않아도 오류가 발생하지 않고 빈 배열을 반환한다.
- 인증 없이 누구나 조회가 가능하다.

#### 상품 상세 정보 조회

**기능적 요구사항**
- 성공 케이스 
  - 사용자는 상품의 상세 정보를 조회할 수 있다.
  - 상품 목록 조회 시 카테고리 별 필터링하여 조회할 수 있다.
- 예외 케이스
  - \-
- 실패 케이스
  - 상품이 존재하지 않으면 오류를 반환한다.

**비기능적 요구사항**
- 인증 없이 누구나 조회가 가능하다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러코드를 반환한다.

| 케이스    | 설명                      | HTTP 상태 코드     |
|--------|-------------------------|----------------|
| 상품 미존재 | 존재 하지 않는 상품의 id로 조회가 요청 | 404, Not Found |


#### 상품 LIKE 등록/취소

**기능적 요구사항**
- 성공 케이스
    - 사용자는 상품을 LIKE 상품으로 등록할 수 있다.
    - LIKE 가 등록된 상품을 LIKE 상품 목록에 추가한다.
    - 사용자는 상품을 LIKE 상품에서 등록 취소할 수 있다.
    - LIKE 등록이 취소된 상품을 LIKE 상품 목록에서 제거한다. 
- 예외 케이스
    - 이미 등록된 상품은 중복으로 LIKE 등록할 수 없다.
    - 이미 LIKE 등록된 상품을 등록하려고 할 때 -#### 아무 동작 없음
    - LIKE 등록되지 않은 상품을 등록 취소하려고 할 때 -#### 아무 동작 없음
- 실패 케이스
    - 상품이 존재하지 않으면 오류를 반환한다.
    - 로그인 하지 않는 사용자에게는 오류를 반환한다.

**비기능적 요구사항**
- 사용자 인증은 `X-USER-ID` HTTP Header를 통해 처리한다. 
- 오류 상황에서는 명확한 HTTP 상태코드와 에러코드를 반환한다.

| 케이스       | 설명                       | HTTP 상태 코드        |
|-----------|--------------------------|-------------------|
| 사용자 권한 없음 | 존재 하지 않는 사용자의 id로 조회가 요청 | 401, Unauthorized |
| 상품 미존재    | 존재 하지 않는 상품의 id로 조회가 요청  | 404, Not Found    |

#### LIKE 등록한 상품 목록 조회

**기능적 요구사항**
- 성공 케이스
    - 사용자는 LIKE 등록한 상품 목록을 조회할 수 있다.
    - LIKE 상품 목록 조회 시 카테고리 별 필터링하여 조회할 수 있다.
- 예외 케이스
    - \-
- 실패 케이스
    - 로그인 하지 않는 사용자에게는 오류를 반환한다.

**비기능적 요구사항**
- 상품이 존재하지 않아도 오류가 발생하지 않고 빈 배열을 반환한다.
- 사용자 인증은 `X-USER-ID` HTTP Header를 통해 처리한다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러코드를 반환한다.

| 케이스       | 설명                       | HTTP 상태 코드        |
|-----------|--------------------------|-------------------|
| 사용자 권한 없음 | 존재 하지 않는 사용자의 id로 조회가 요청 | 401, Unauthorized |

---

### 브랜드 관련

#### 브랜드 상세 정보 조회

**기능적 요구사항**
- 성공 케이스
    - 사용자는 브랜드의 상세 정보를 조회할 수 있다.
- 예외 케이스
    - \-
- 실패 케이스
    - 브랜드가 존재하지 않으면 오류를 반환한다.

**비기능적 요구사항**
- 인증 없이 누구나 조회가 가능하다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러코드를 반환한다.

| 케이스     | 설명                       | HTTP 상태 코드     |
|---------|--------------------------|----------------|
| 브랜드 미존재 | 존재 하지 않는 브랜드의 id로 조회가 요청 | 404, Not Found |

#### \[TODO\] 브랜드 상품 조회 - TODO

#### \[TODO\] 브랜드 LIKE 등록, 취소 - TODO

#### \[TODO\] LIKE 등록한 브랜드 목록 조회 

---

### 주문 관련

#### 주문 생성

**기능적 요구사항**
- 성공 케이스
    - 사용자는 상품들을 구매하기 위한 주문을 생성한다.
    - 주문 안에는 1개 이상의 상품이 포함된다.
- 예외 케이스
    - \-
- 실패 케이스
    - 존재하지 않는 상품이 주문에 포함된다면 주문 생성 시 에러가 발생한다.
    - "판매 중" 상태가 아닌 상품이 포함된다면 주문 생성 시 에러가 발생한다.
    - 로그인 하지 않은 사용자에게는 오류를 반환한다.

**비기능적 요구사항**
- 사용자 인증은 `X-USER-ID` HTTP Header를 통해 처리한다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러코드를 반환한다.

| 케이스       | 설명                          | HTTP 상태 코드        |
|-----------|-----------------------------|-------------------|
| 사용자 권한 없음 | 존재 하지 않는 사용자의 id로 조회가 요청    | 401, Unauthorized |
| 상품 미존재    | 존재 하지 않는 상품 id가 포함됨         | 400, Bad Request  |
| 판매중 상품 아님 | 상품의 존재가 품절, 단종 등 판매중 상태가 아님 | 409, Conflict     |

#### 주문 결제 처리

**기능적 요구사항**
- 성공 케이스
    - 결제 건에 해당하는 주문의 상태를 "결제 완료"로 변경한다.
    - 결제가 성공한다면 주문 개수만큼 상품의 재고가 차감된다.
    - 결제가 성공한다면 결제 금액만큼 포인트가 차감된다.
    - 결제가 성공한다면 외부 시스템에 주문 정보를 전송한다.
- 예외 케이스
    - \-
- 실패 케이스
    - 결제의 대상 주문의 정보가 존재하지 않는다면 오류가 발생한다.
    - 주문의 상태가 "결제 대기" 상태가 아니라면 오류가 발생한다.
    - 존재하지 않는 상품이 주문에 포함된다면 결제 처리 시 오류가 발생한다.
    - "판매 중" 상태가 아닌 상품이 포함된다면 주문 생성 시 에러가 발생한다.
    - 상품의 재고가 부족하다면 에러가 발생한다.
    - 포인트가 부족하다면 에러가 발생한다.
    - 외부 시스템과의 통신에 실패하면 에러가 발생한다. 
      - 로그를 기록 또는 알림을 위함이라면 비동기 처리를 하기 때문에 에러를 줄 수 없지 않을까?
      - 어떤 외부시스템을 사용하는지 전부 작성해야 할까?
        - e.g. 결제 시스템과 통신에 실패하면 에러가 발생한다.
        - e.g. 결제 완료 알림 MMS 시스템과 통신에 실패하면, slack 채널에 실패 알림을 전송한다.
    - 로그인 하지 않은 사용자에게는 오류를 반환한다.

**비기능적 요구사항**
- 사용자 인증은 `X-USER-ID` HTTP Header를 통해 처리한다.
- 오류 상황에서는 명확한 HTTP 상태코드와 에러코드를 반환한다.

| 케이스          | 설명                          | HTTP 상태 코드            |
|--------------|-----------------------------|-----------------------|
| 사용자 권한 없음    | 존재 하지 않는 사용자의 id로 조회가 요청    | 401, Unauthorized     |
| 주문 미존재       | 존재하지 않는 주문의 결제가 요청됨         | 404, Not Found        |
| 주문 상태 이상     | 주문의 상태가 "결제 대기"가 아님         | 409,Conflict          |
| 상품 미존재       | 존재 하지 않는 상품 id가 포함됨         | 400, Bad Request      |
| 판매중 상품 아님    | 상품의 존재가 품절, 단종 등 판매중 상태가 아님 | 409, Conflict         |
| 상품 재고 부족     | 주문 대상 상품의 재고가 부족한 경우        | 409, Conflict         |
| 결제 실패        | 잔여 포인트 부족                   | 402, Payment Required |
| 외부 시스템 연동 실패 | 외부 시스템과의 통신 오류              | 502, Bad Gateway      |

---
